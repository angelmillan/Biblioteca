/* Script proyecto de recuperación.*/
/* Angel Millan Miralles 1ºDAM */

PRAGMA foreign_keys = ON;

DROP TABLE IF EXISTS libros;
DROP TABLE IF EXISTS ejemplares;
DROP TABLE IF EXISTS usuarios;
DROP TABLE IF EXISTS prestamos;

CREATE TABLE libros
(
ISBN 			TEXT PRIMARY KEY,
TITULO			TEXT NOT NULL ,
AUTOR			TEXT NOT NULL,
EDITORIAL 		TEXT NOT NULL,
EDICION			TEXT
);


CREATE TABLE ejemplares
(

ISBN_ejemplar 	TEXT NOT NULL ,
NUMERO_ejemplar INTEGER NOT NULL CHECK (NUMERO_Ejemplar > 0),
UNIQUE (ISBN_Ejemplar,NUMERO_ejemplar),

PRIMARY KEY (ISBN_ejemplar, NUMERO_ejemplar),		
FOREIGN KEY (ISBN_ejemplar) REFERENCES libros(ISBN)

);


CREATE TABLE usuarios
(
DNI             TEXT PRIMARY KEY,
NOMBRE          TEXT NOT NULL,
APELLIDOS       TEXT NOT NULL,
DIRECCION       TEXT

);

CREATE TABLE prestamos
(
FECHA           TEXT DEFAULT CURRENT_TIMEDATE,
DNI             TEXT ,
CLAVE_EJEMPLAR  TEXT,

PRIMARY KEY (DNI, CLAVE_EJEMPLAR, FECHA),
FOREIGN KEY (DNI)REFERENCES usuarios(DNI),
FOREIGN KEY (CLAVE_EJEMPLAR) REFERENCES ejemplares(ID)

);

.read Libros.sql
.read Usuarios.sql
.read ejemplares.sql
